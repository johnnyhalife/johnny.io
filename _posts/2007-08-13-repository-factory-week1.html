--- 
layout: post
title: Repository Factory - Week#1
published: true
meta: {}

tags: 
- Architecture
- cool stuff
- Patterns &amp; Practices
- Repository Factory
type: post
status: publish
---

        <p>We&#39;ve completed the first week working on the <a href="http://www.codeplex.com/RepositoryFactory">Repository Factory project</a>. As I mentioned on <a href="/blogs/johnny/archive/2007/08/07/Repository-Factory-kick-off_2100_.aspx">a previous post</a>, Chris Tavares and I are working on this amazing project.<br />I&#39;d like to share with you the improvements we&#39;ve done during this week, and remember that your vote decides the future of the project. Enter codeplex and <a href="http://www.codeplex.com/RepositoryFactory/WorkItem/List.aspx" target="_blank">keep voting</a>, we&#39;re tackling most voted stuff.</p><h3>GAT/GAX July 2007 Support</h3><p>We have migrated the guidance package to GAT/GAX July 2007 CTP. More about GAT/GAX 2007 migration can be <a href="/blogs/siacomuzzi/archive/2007/08/06/How-to_3A00_-Upgrade-to-GAT_2F00_GAX-July-2007-CTP.aspx" target="_blank">found here</a>.</p><h3>Service Factory independent</h3><p>We&#39;ve removed all the dependencies to <a href="http://www.codeplex.com/ServiceFactory" target="_blank">Microsoft Patterns &amp; Practices Service Factory</a>, so you can run the package without the necessity of having the Service Factory installed.</p><h3>Place generic code into its own DLL</h3><p>As you might recall the formerly <em>Data Access Guidance Package </em>generated a folder called generic on your Data Access Project. The intent of that was having base-classes for the repository assets. But that code was always the same, so we moved that code a new assembly called <em><strong>Microsoft.Practices.Repository</strong></em>. This new assembly contains the generic code, making your DAC projects are smaller, and easy to maintain.</p><h3>Generate interface for Repository</h3><p>Let&#39;s explain this point with little bit of code. Suppose that we&#39;ve a presenter class, that uses the repository, and we want to use <a href="http://en.wikipedia.org/wiki/Inversion_of_control" target="_blank">IoC pattern</a>. Our code should look like this:</p><div style="font-size: 8pt;margin: 20px 0px 10px;width: 97.5%;font-family: consolas, 'Courier New', courier, monospace;border: gray 1px solid;padding: 4px"><pre style="font-size: 8pt;margin: 0em;width: 100%;color: black;font-family: consolas, 'Courier New', courier, monospace;padding: 0px"><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> Presenter
{
     <span style="color: #0000ff">public</span> Presenter(Repository repository)      
     {
        <span style="color: #008000">//TODO: Add some constructor logic here</span>
     }
}</pre></div><p>Since we&#39;re sticking to the concrete repository implementation, we won&#39;t be able to mock the repository implementation, when we want to write a unit test. Ok, you might be thinking that you can easily do <em>Right Click -&gt; Extract Interface</em>, we knew that but better than using the refactoring tools we&#39;re doing it for you. Both repository and interface are generated by <em>Repository Factory.</em> e.g.</p><div style="font-size: 8pt;margin: 20px 0px 10px;width: 97.5%;font-family: consolas, 'Courier New', courier, monospace;border: gray 1px solid;padding: 4px"><pre style="font-size: 8pt;margin: 0em;width: 100%;color: black;font-family: consolas, 'Courier New', courier, monospace;height: 225px;padding: 0px"><span style="color: #008000">//The interface generated by RF</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">interface</span> IMyRepository
{
     <span style="color: #0000ff">void</span> Add(MyEntity entity);
}

<span style="color: #008000">//The concrete class</span>
<span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> Repository : IMyRepository
{
       <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> Add(MyEntity entity)
       {
       }
}</pre></div><h3><font face="Tahoma">Create factory to retrieve repositories </font></h3><p>Based on the previously explained improvement (<em>Generate Interface for Repository</em>)<em>, </em>we&#39;ve created a RepositoryFactory (besides the GP, a class) that you can use on your code to insulate callers from the concrete repository implementation. Based on this you can write code to retrieve the repository by it&#39;s interface and then you can change the implementation by modifying the config file.</p><h4>Usage</h4><div style="font-size: 8pt;margin: 20px 0px 10px;width: 97.5%;font-family: consolas, 'Courier New', courier, monospace;border: gray 1px solid;padding: 4px"><pre style="font-size: 8pt;margin: 0em;width: 100%;color: black;font-family: consolas, 'Courier New', courier, monospace;padding: 0px"><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> SomeMethod()
{
      IPersonRepository repository =
                RepositoryFactory.Create(connectionString);
}</pre></div><p>On the config file you&#39;ll have something like this<br /></p><div style="font-size: 8pt;margin: 20px 0px 10px;width: 97.5%;font-family: consolas, 'Courier New', courier, monospace;border: gray 1px solid;padding: 4px"><pre style="font-size: 8pt;margin: 0em;width: 100%;color: black;font-family: consolas, 'Courier New', courier, monospace;padding: 0px"><span style="color: #0000ff">&lt;</span><span style="color: #800000">repositoryFactory</span><span style="color: #0000ff">&gt;</span>
      <span style="color: #0000ff">&lt;</span><span style="color: #800000">repositories</span><span style="color: #0000ff">&gt;</span>
             <span style="color: #0000ff">&lt;</span><span style="color: #800000">add</span> <span style="color: #ff0000">repositoryInterface</span><span style="color: #0000ff">="IMyRepository, MyAssembly"</span> 
                  <span style="color: #ff0000">repositoryType</span><span style="color: #0000ff">="MyRepository, MyAssembly"</span> <span style="color: #0000ff">/&gt;</span>
      <span style="color: #0000ff">&lt;/</span><span style="color: #800000">repositories</span><span style="color: #0000ff">&gt;</span>
<span style="color: #0000ff">&lt;/</span><span style="color: #800000">repositoryFactory</span><span style="color: #0000ff">&gt;</span></pre></div><h3><strong>Auto-map entity fields to Stored Procedure parameters</strong></h3><p>Sometimes you&#39;ll have to add an operation to your repository that is more than just a single CRUD operation. Previously when you needed to create this operation you had to map the input/output parameters and return values from to entity fields. Now we&#39;ve improved this by automating the mapping. It&#39;s a little bit smarter than just mapping <strong>Name -&gt; sProcName, </strong>it performs the mapping ignoring case and removing "pty_" (and other suffixes).</p><h3>Summary</h3><p>We finished this first week, all the tackled issues were not invented by us, they are community requests. We&#39;re listening to you, please feel free to provide feedback in our <a href="http://www.codeplex.com/RepositoryFactory" target="_blank">community site</a>. We work on the improvements starting with highly ranked ones, you have a chance to influence the course of the project.</p><p>We&#39;re going to be delivering a CTP version soon! So stay tuned...</p><p>thanks,<br />~johnny</p><h4>PS. Acknowledgements</h4><p>I want to thank <a href="/blogs/parancibia/default.aspx" target="_blank">Paulo</a> who gave my blog the new head-wash, he is a really creative person, don&#39;t forget to <a href="/blogs/parancibia/default.aspx" target="_blank">check out his blog...</a></p>
      
