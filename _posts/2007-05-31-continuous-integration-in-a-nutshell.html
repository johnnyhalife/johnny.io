--- 
layout: post
title: Continuous Integration in a nutshell
published: true
meta: {}

tags: 
- continuous integraton
- cool stuff
type: post
status: publish
---
<p>Last week <a href="http://staff.southworks.net/blogs/matiaswoloski/">Mat&#237;as</a> and I were working on automating the builds of our projects. We didn't want just to automated the building process, we also wanted to implement <a href="http://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration</a>. Throughout this post, I'll share the experience we've had since we started.</p>  <h5>Which product to use?</h5>  <p>We started with Microsoft Visual Studio Team Foundation Server, since it's our configuration management platform. We did research over the build services that come out-of-the-box and a little bit of spiking extending those services using the API.   <br />Our first spike consisted in creating a WebService that subscribes to TFS Check-In Event. We didn't have so much luck with this, since for each project you've to configure a bunch of things, handling those build projects is not straightforward. We were a little bit dissapointed, we wanted to take advantage of TFS integration on Visual Studio 2005.</p>  <p>We kept moving over the internet til we found&#160; <a href="http://www.continuousintegration.net">CC.net</a>, this is an open-source product created by <a href="http://www.thoughtworks.com/index.html">Thoughtworks</a>, it's an extensible automation platform were you can configure multiple things as FxCop, NUnit, NCover, among others. Also it integrates with mutiple source control providers. So we decided to give it a chance.</p>  <h5>Trying Cruise Control.net</h5>  <p>As an old-fashioned geek, I'll never download a source control project in MSI project and let another geek decide where and how should I install their products. We downloaded the binary-zipped version of Cruise Control.net. We unzipped the package and started to see what's in there. Inside the zip file we found:</p>  <ul>   <li>Documentation, each released (not-live) version of CC.net includes all the documentation to be used locally. </li>    <li>Server, is the server application. This application whose responsibilities are:&#160; listen SCC for changes, create a local workspace on the build machine, and perform the configured tasks (run FxCop, run NUnit tests, etc.). It cames in two formats, Windows Service and Console application. </li>    <li>CCTray, this is the client application for developers to check 24*7 the build health, is the desktop way to monitor your projects. </li>    <li>WebDashboard, is the web application where you can force builds, get an overall project portfolio health status, and review log files.</li> </ul>  <p>Now that we knew what's in there, we started to configure CC.NET (on Longhorn Server Beta 3).</p>  <h5>Configuring Cruise Control.net</h5>  <p>First of all we needed a box where we can deploy it. We created a VPC with the following characteristics:</p>  <ul>   <li>Windows Longhorn Server B3 (minimun installation, with IIS7 and Powershell features). </li>    <li>1GB of RAM </li>    <li>Hosted on Virtual Server Enterprise R2</li> </ul>  <p>Once we had the box, we started with the CC.NET service configuration. We read <a href="http://confluence.public.thoughtworks.org/display/CCNET/Configuring+the+Server">this guide, for step-by-step installation</a>, we choosed <a href="http://vstsplugins.sourceforge.net/index.php/archives/news/2005/10">VSTS plug-in</a> for monitoring source control, and <a href="http://confluence.public.thoughtworks.org/display/CCNET/Using+CruiseControl.NET+with+MSBuild">MSBuild</a> as the build task.</p>  <p>We started with just a single project, a common .net 2.0 project, it built succesfuly. So CI was running, so we said : &quot;Ok, next step let's monitor this&quot;. First we went for the webdashboard, deploying it on the IIS7 as <a href="http://confluence.public.thoughtworks.org/display/CCNET/Configuring+the+Web+Dashboard">it's explained on this page.</a> (<strong>Note for II7 users: You should change the AppPool to be .Net Classic cause the WebDashboard comes with kind-of rewritting http module, not supported by default on IIS7 configuration</strong>).</p>  <p>We navegated to webpage <a href="http://localhost/webdashboard">http://localhost/webdashboard</a>, and voila! it was there. Then we decided to go <a href="http://confluence.public.thoughtworks.org/display/CCNET/CCTray">for CCTray</a> since we thought :&#160; &quot;Cool, I've got this configured but now howwe let the devs know when they brake the build&quot;. So we took a look to the CCTray application that comes out-of-the-box and it just was a plug-and-play thing, we configured it to use the WebDashboard connection mode pointed to the <a href="http://buildServer/webdashboard/">http://buildServer/webdashboard/</a> and showed up the project we had previously configured.</p>  <p>Up to this point we were really enthusiastic about how things were going, we went for more configuring the whole portfolio on the build server, but suddenly popped up a problem not all projects have same target platforms, same involved technologies, and we wanted each project to built just with it minimum requiriments so we avoid things like incompatibillity of technologies and we ensured (more at this point) the quality of our deliverables.</p>  <h5>Creating the scalable and extensible Build Services model</h5>  <p>We started the design of this infrastructe based on the following premises:</p>  <ul>   <li>We wanted a single dashboard for the whole project portfolio </li>    <li>We wanted a single source for CCTray </li>    <li>We wanted to scale out adding for e.g. 3 more types of build servers or reducing the number of them with out pain, and with no need of configuring everything again. </li>    <li>We wanted mutiple build machines with different platforms and software inside them.</li> </ul>  <p>Researching, we found that on the dashboard.config you can tell your dashboard where are your build machines, and contact them via remoting, and also we discovered that you can have more than one application (build server) configured for your dashboard. How to modify the dashboard.config can be found here, <a href="http://confluence.public.thoughtworks.org/display/CCNET/Servers+Configuration+Block">on the CC.net documentation</a>.</p>  <p>Finally in the following diagram we're showing how was the initial CC.NET Deployment Strategy (single server) and the design we came up with.</p>  <h6>Default Deployment</h6>  <p><img height="138" src="http://farm1.static.flickr.com/191/522465080_4c61d2ec82.jpg?v=0" width="466" /></p>  <h6>Final Deployement</h6>  <p><img height="304" src="http://farm1.static.flickr.com/190/522476919_548d01e966.jpg?v=0" width="468" /></p>  <p>thanks,   <br />~johnny</p>
